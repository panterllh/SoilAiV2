<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ AI - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏î‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä">
    <title>SoilAI - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå±</text></svg>">
    
    <!-- TensorFlow.js - Load First -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
    
    <!-- jsPDF for export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ============================================
           Variables & Reset
        ============================================ */
        :root {
            --primary-color: #2ecc71;
            --primary-dark: #27ae60;
            --secondary-color: #3498db;
            --secondary-dark: #2980b9;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --text-color: #34495e;
            --border-radius: 12px;
            --transition: all 0.3s ease;
            --shadow: 0 5px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        /* Dark mode variables */
        body.dark-mode {
            --primary-color: #2ecc71;
            --secondary-color: #3498db;
            --dark-color: #1a1a2e;
            --light-color: #16213e;
            --text-color: #eee;
            --shadow: 0 5px 20px rgba(0,0,0,0.3);
            background: #0f0f1e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Prompt', sans-serif;
            background: #f5f7fa;
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
        }
        
        /* ============================================
           Header & Navigation
        ============================================ */
        header {
            background: var(--dark-color);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }
        
        nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            transition: var(--transition);
            position: relative;
        }
        
        .nav-links a:hover {
            color: var(--primary-color);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: width 0.3s;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        /* Dark mode toggle */
        .theme-toggle {
            background: none;
            border: 2px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .theme-toggle:hover {
            background: white;
            color: var(--dark-color);
        }
        
        /* ============================================
           Main Container
        ============================================ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 20px 40px;
        }
        
        /* Hero Section */
        .hero {
            text-align: center;
            padding: 60px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        /* ============================================
           Main Grid Layout
        ============================================ */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        /* Card Component */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        body.dark-mode .card {
            background: var(--light-color);
        }
        
        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .card-header h2 {
            font-size: 1.5rem;
            color: var(--dark-color);
        }
        
        body.dark-mode .card-header h2 {
            color: white;
        }
        
        .card-header i {
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        /* ============================================
           Upload Section
        ============================================ */
        .upload-container {
            position: relative;
        }
        
        .upload-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .upload-option {
            padding: 20px;
            border: 2px dashed var(--secondary-color);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .upload-option:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: var(--secondary-dark);
            transform: scale(1.02);
        }
        
        .upload-option i {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
            display: block;
        }
        
        .upload-area {
            border: 3px dashed var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(52, 152, 219, 0.05);
            position: relative;
        }
        
        .upload-area.dragover {
            background: rgba(52, 152, 219, 0.15);
            border-color: var(--secondary-dark);
        }
        
        #imageInput {
            display: none;
        }
        
        /* Preview Section */
        .preview-container {
            margin-top: 20px;
            text-align: center;
            display: none;
        }
        
        #previewImage {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        /* Camera Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            position: relative;
            background: white;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: var(--border-radius);
            animation: slideIn 0.3s;
        }
        
        body.dark-mode .modal-content {
            background: var(--light-color);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        #cameraVideo {
            width: 100%;
            border-radius: var(--border-radius);
        }
        
        .camera-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        /* ============================================
           Buttons
        ============================================ */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        /* ============================================
           Results Section
        ============================================ */
        .result-display {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .soil-result {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            border-radius: var(--border-radius);
            margin-bottom: 25px;
        }
        
        body.dark-mode .soil-result {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
        }
        
        .soil-icon {
            font-size: 5rem;
            margin-bottom: 15px;
            display: block;
            animation: bounceIn 0.5s;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0); }
            60% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .soil-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .confidence-container {
            margin: 20px 0;
        }
        
        .confidence-bar {
            background: #e0e0e0;
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        /* Recommendations */
        .recommendations {
            background: rgba(46, 204, 113, 0.1);
            padding: 25px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }
        
        body.dark-mode .recommendations {
            background: rgba(46, 204, 113, 0.05);
        }
        
        .recommendation-item {
            display: flex;
            align-items: start;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        body.dark-mode .recommendation-item {
            background: var(--dark-color);
        }
        
        .recommendation-item:hover {
            transform: translateX(5px);
        }
        
        .recommendation-item i {
            color: var(--primary-color);
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        
        /* ============================================
           Stats Cards
        ============================================ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid var(--primary-color);
        }
        
        body.dark-mode .stat-card {
            background: var(--light-color);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .stat-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: block;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        body.dark-mode .stat-value {
            color: white;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        

        
        /* ============================================
           Comparison Mode
        ============================================ */
        .comparison-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .comparison-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        body.dark-mode .comparison-card {
            background: var(--light-color);
        }
        
        .comparison-card:hover {
            transform: scale(1.05);
        }
        
        .comparison-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .comparison-info {
            padding: 15px;
        }
        
        .comparison-info h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        /* ============================================
           History Section
        ============================================ */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        body.dark-mode .history-table th,
        body.dark-mode .history-table td {
            border-bottom-color: #333;
        }
        
        .history-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .history-table tr:hover {
            background: rgba(46, 204, 113, 0.1);
        }
        
        /* ============================================
           Loading & Error States
        ============================================ */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            display: none;
            border-left: 4px solid #c33;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            display: none;
            border-left: 4px solid #28a745;
        }
        
        /* ============================================
           Footer
        ============================================ */
        footer {
            background: var(--dark-color);
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-top: 80px;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover {
            color: var(--primary-color);
        }
        
        /* ============================================
           Responsive Design
        ============================================ */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .main-grid,
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .upload-methods {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .comparison-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* ============================================
           Utilities
        ============================================ */
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .hidden { display: none !important; }
        
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* Selection color */
        ::selection {
            background: var(--primary-color);
            color: white;
        }
        
        /* Mock Model Notice */
        .model-notice {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
            display: none;
        }
        
        body.dark-mode .model-notice {
            background: #332701;
            color: #fff3cd;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <div class="logo">
                <i class="fas fa-seedling"></i>
                SoilAI
            </div>
            <div class="nav-links">
                <a href="#home">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                <a href="#analyze">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</a>
                <a href="#history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
                <a href="#about">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö</a>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </nav>
    </header>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Hero Section -->
        <section class="hero" id="home">
            <h1>üå± ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h1>
            <p>‡πÉ‡∏ä‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</p>
        </section>
        
        <!-- Model Notice -->
        <div class="model-notice" id="modelNotice">
            <i class="fas fa-info-circle"></i> <strong>‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå Model
        </div>
        
        <!-- Stats Grid -->
        <section class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-chart-line stat-icon"></i>
                <div class="stat-value" id="accuracyStat">95%</div>
                <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-images stat-icon"></i>
                <div class="stat-value" id="imagesStat">180</div>
                <div class="stat-label">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ù‡∏∂‡∏Å</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-layer-group stat-icon"></i>
                <div class="stat-value">3</div>
                <div class="stat-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏î‡∏¥‡∏ô</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock stat-icon"></i>
                <div class="stat-value" id="analyzeCount">0</div>
                <div class="stat-label">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡πâ‡∏ß</div>
            </div>
        </section>
        
        <!-- Main Grid -->
        <section class="main-grid" id="analyze">
            <!-- Upload Section -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-upload"></i>
                    <h2>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏î‡∏¥‡∏ô</h2>
                </div>
                
                <div class="upload-container">
                    <!-- Upload Methods -->
                    <div class="upload-methods">
                        <div class="upload-option" onclick="document.getElementById('imageInput').click()">
                            <i class="fas fa-file-image"></i>
                            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                        </div>
                        <div class="upload-option" onclick="openCamera()">
                            <i class="fas fa-camera"></i>
                            <p>‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</p>
                        </div>
                    </div>
                    
                    <!-- Drag & Drop Area -->
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--secondary-color);"></i>
                        <p>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                        <p style="font-size: 0.9rem; opacity: 0.7;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB</p>
                    </div>
                    
                    <input type="file" id="imageInput" accept="image/*">
                    
                    <!-- Preview -->
                    <div class="preview-container" id="previewContainer">
                        <img id="previewImage" alt="Preview">
                    </div>
                    
                    <!-- Loading -->
                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô...</p>
                    </div>
                    
                    <!-- Messages -->
                    <div class="error-message" id="errorMessage"></div>
                    <div class="success-message" id="successMessage"></div>
                    
                    <!-- Action Buttons -->
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="analyzeImage()" id="analyzeBtn" style="display: none;">
                            <i class="fas fa-search"></i> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                        </button>
                        <button class="btn btn-secondary" onclick="resetUpload()">
                            <i class="fas fa-redo"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Results Section -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-poll"></i>
                    <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
                </div>
                
                <div class="result-display" id="resultDisplay">
                    <div class="soil-result">
                        <div class="soil-icon" id="soilIcon">
                            <i class="fas fa-question-circle" style="font-size: 5rem;"></i>
                        </div>
                        <h3 class="soil-name" id="soilName">-</h3>
                        <div class="confidence-container">
                            <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à</p>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="confidenceFill" style="width: 0%">0%</div>
                            </div>
                        </div>
                        
                        <!-- pH and Moisture Indicators -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px;">
                            <div style="background: rgba(52, 152, 219, 0.1); padding: 20px; border-radius: 10px;">
                                <i class="fas fa-flask" style="color: #3498db; font-size: 2rem; margin-bottom: 10px;"></i>
                                <h4 style="margin: 5px 0; color: #3498db;">‡∏Ñ‡πà‡∏≤ pH</h4>
                                <div id="phValue" style="font-size: 2rem; font-weight: 700;">-</div>
                                <small id="phStatus" style="color: #7f8c8d;">-</small>
                            </div>
                            <div style="background: rgba(46, 204, 113, 0.1); padding: 20px; border-radius: 10px;">
                                <i class="fas fa-tint" style="color: #2ecc71; font-size: 2rem; margin-bottom: 10px;"></i>
                                <h4 style="margin: 5px 0; color: #2ecc71;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</h4>
                                <div id="moistureValue" style="font-size: 2rem; font-weight: 700;">-</div>
                                <small id="moistureStatus" style="color: #7f8c8d;">-</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendations">
                        <h3><i class="fas fa-lightbulb"></i> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
                        <div id="recommendationsList"></div>
                    </div>
                    
                    <!-- Export Buttons -->
                    <div class="btn-group mt-20">
                        <button class="btn btn-primary" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                        <button class="btn btn-secondary" onclick="shareResult()">
                            <i class="fas fa-share-alt"></i> ‡πÅ‡∏ä‡∏£‡πå
                        </button>
                        <button class="btn btn-secondary" onclick="saveToHistory()">
                            <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div class="text-center" id="emptyResult">
                    <i class="fas fa-microscope" style="font-size: 4rem; color: #ddd; margin-bottom: 20px;"></i>
                    <p style="color: #95a5a6;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
                    <p style="color: #bdc3c7; font-size: 0.9rem;">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏î‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
                </div>
            </div>
        </section>
        
        <!-- History Section -->
        <section class="card" id="history">
            <div class="card-header">
                <i class="fas fa-history"></i>
                <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>
            </div>
            
            <div class="btn-group mb-20">
                <button class="btn btn-primary" onclick="exportHistory('csv')">
                    <i class="fas fa-file-csv"></i> Export CSV
                </button>
                <button class="btn btn-danger" onclick="clearHistory()">
                    <i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                </button>
            </div>
            
            <div id="historyContent">
                <p class="text-center" style="color: #95a5a6;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
            </div>
        </section>
    </div>
    
    <!-- Camera Modal -->
    <div class="modal" id="cameraModal">
        <div class="modal-content">
            <h3><i class="fas fa-camera"></i> ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏î‡∏¥‡∏ô</h3>
            <video id="cameraVideo" autoplay></video>
            <canvas id="cameraCanvas" style="display: none;"></canvas>
            <div class="camera-controls">
                <button class="btn btn-primary" onclick="capturePhoto()">
                    <i class="fas fa-camera"></i> ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ
                </button>
                <button class="btn btn-danger" onclick="closeCamera()">
                    <i class="fas fa-times"></i> ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="#about">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
                <a href="#contact">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</a>
                <a href="#privacy">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
            </div>
            <p>&copy; 2024 SoilAI - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
        </div>
    </footer>
    
    <script>
        // ============================================
        // Global Variables
        // ============================================
        let model = null;
        let cameraStream = null;
        let analysisHistory = [];
        let analyzeCount = 0;
        let mockMode = false;
        
        // Soil type data with Font Awesome icons
        const soilTypes = {
            0: {
                name: '‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô',
                nameEn: 'Loam',
                icon: 'fa-seedling',
                iconText: 'üåæ',
                color: '#8B4513',
                phRange: { min: 6.0, max: 7.0 },
                moistureRange: { min: 25, max: 35 },
                recommendations: [
                    { icon: 'fa-check-circle', text: '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏±‡∏Å ‡πÑ‡∏°‡πâ‡∏î‡∏≠‡∏Å ‡πÑ‡∏°‡πâ‡∏ú‡∏•' },
                    { icon: 'fa-tint', text: '‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡πâ‡∏°‡∏ô‡πâ‡∏≥‡∏™‡∏°‡∏î‡∏∏‡∏• ‡∏£‡∏î‡∏ô‡πâ‡∏≥ 2-3 ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á' },
                    { icon: 'fa-seedling', text: '‡∏Ñ‡∏ß‡∏£‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏∏‡πã‡∏¢‡∏Ñ‡∏≠‡∏Å 2-3 ‡∏Å‡∏Å./‡∏ï‡∏£.‡∏°.' },
                    { icon: 'fa-chart-line', text: 'pH ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°: 6.0-7.0 ‡πÉ‡∏ä‡πâ‡∏õ‡∏π‡∏ô‡∏Ç‡∏≤‡∏ß‡∏õ‡∏£‡∏±‡∏ö‡∏ñ‡πâ‡∏≤ pH ‡∏ï‡πà‡∏≥' },
                    { icon: 'fa-thermometer-half', text: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°: 25-30¬∞C' }
                ]
            },
            1: {
                name: '‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏¢',
                nameEn: 'Sand',
                icon: 'fa-umbrella-beach',
                iconText: 'üèúÔ∏è',
                color: '#F4A460',
                phRange: { min: 5.5, max: 7.0 },
                moistureRange: { min: 10, max: 20 },
                recommendations: [
                    { icon: 'fa-tint', text: '‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏î‡∏ô‡πâ‡∏≥‡∏ö‡πà‡∏≠‡∏¢ (‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô) ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏£‡πá‡∏ß' },
                    { icon: 'fa-leaf', text: '‡∏Ñ‡∏ß‡∏£‡∏ú‡∏™‡∏°‡∏õ‡∏∏‡πã‡∏¢‡∏Ñ‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏∏‡πã‡∏¢‡∏´‡∏°‡∏±‡∏Å 3-5 ‡∏Å‡∏Å./‡∏ï‡∏£.‡∏°.' },
                    { icon: 'fa-carrot', text: '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡∏ä‡∏£‡∏≤‡∏Å‡∏•‡∏∂‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏Ñ‡∏£‡∏≠‡∏ó ‡∏´‡∏±‡∏ß‡πÑ‡∏ä‡πÄ‡∏ó‡πâ‡∏≤ ‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á' },
                    { icon: 'fa-chart-line', text: 'pH ‡∏ó‡∏µ‡πà‡∏û‡∏ö: 5.5-7.0 ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡πà‡∏≠‡∏¢' },
                    { icon: 'fa-sun', text: '‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏¥‡∏ô' }
                ]
            },
            2: {
                name: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß',
                nameEn: 'Clay',
                icon: 'fa-cube',
                iconText: 'üü´',
                color: '#654321',
                phRange: { min: 5.0, max: 6.5 },
                moistureRange: { min: 35, max: 50 },
                recommendations: [
                    { icon: 'fa-water', text: '‡∏≠‡∏∏‡πâ‡∏°‡∏ô‡πâ‡∏≥‡∏î‡∏µ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏ä‡πâ‡∏≤ ‡∏£‡∏î‡∏ô‡πâ‡∏≥ 4-5 ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á' },
                    { icon: 'fa-mountain', text: '‡∏Ñ‡∏ß‡∏£‡∏ú‡∏™‡∏°‡∏ó‡∏£‡∏≤‡∏¢‡∏´‡∏¢‡∏≤‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡∏•‡∏ö 20-30%' },
                    { icon: 'fa-tractor', text: '‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏ñ‡∏û‡∏£‡∏ß‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏•‡∏π‡∏Å ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÉ‡∏ô‡∏î‡∏¥‡∏ô' },
                    { icon: 'fa-chart-line', text: 'pH ‡∏ó‡∏µ‡πà‡∏û‡∏ö: 5.0-6.5 ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏õ‡∏π‡∏ô‡∏Ç‡∏≤‡∏ß' },
                    { icon: 'fa-exclamation-triangle', text: '‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°‡∏Ç‡∏±‡∏á ‡∏Ñ‡∏ß‡∏£‡∏¢‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏•‡∏π‡∏Å' }
                ]
            }
        };
        
        // ============================================
        // Initialization
        // ============================================
        window.onload = async function() {
            await loadModel();
            setupEventListeners();
            loadHistory();
            checkTheme();
            updateStats();
        };
        
        // Load TensorFlow model
        async function loadModel() {
            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö base path ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GitHub Pages
                const isGitHubPages = window.location.hostname.includes('github.io');
                const pathArray = window.location.pathname.split('/').filter(p => p);
                let basePath = '';
                
                // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô GitHub Pages ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà root domain
                if (isGitHubPages && pathArray.length > 0 && !window.location.pathname.endsWith('.html')) {
                    basePath = '/' + pathArray[0];
                }
                
                const modelPath = basePath + '/tfjs_model/model.json';
                console.log('Loading model from:', modelPath);
                
                // Try to load the actual model
                model = await tf.loadLayersModel(modelPath);
                console.log('Model loaded successfully');
                mockMode = false;
                
                // Load stats if available
                try {
                    const statsPath = basePath + '/tfjs_model/stats.json';
                    const response = await fetch(statsPath);
                    if (response.ok) {
                        const stats = await response.json();
                        document.getElementById('accuracyStat').textContent = 
                            `${(stats.accuracy * 100).toFixed(1)}%`;
                        document.getElementById('imagesStat').textContent = 
                            stats.total_images.toLocaleString();
                    }
                } catch (e) {
                    console.log('Stats file not found, using defaults');
                }
                
                showMessage('‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'success');
                
            } catch (error) {
                console.error('Error loading model:', error);
                // Enable mock mode
                mockMode = true;
                document.getElementById('modelNotice').style.display = 'block';
                showMessage('‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå Model', 'info');
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            const uploadArea = document.getElementById('uploadArea');
            const imageInput = document.getElementById('imageInput');
            
            // Click to upload
            uploadArea.addEventListener('click', () => imageInput.click());
            
            // File input change
            imageInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
        }
        
        // ============================================
        // File Handling
        // ============================================
        function handleFileSelect(e) {
            handleFiles(e.target.files);
        }
        
        function handleFiles(files) {
            if (files.length === 0) return;
            
            // Only handle single file
            handleSingleFile(files[0]);
        }
        
        function handleSingleFile(file) {
            if (!validateFile(file)) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('previewImage');
                preview.src = e.target.result;
                document.getElementById('previewContainer').style.display = 'block';
                document.getElementById('analyzeBtn').style.display = 'inline-flex';
                document.getElementById('emptyResult').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
        
        function validateFile(file) {
            if (!file.type.startsWith('image/')) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
                return false;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                showMessage('‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB', 'error');
                return false;
            }
            
            return true;
        }
        
        // ============================================
        // Image Analysis
        // ============================================
        async function analyzeImage() {
            const preview = document.getElementById('previewImage');
            if (!preview.src || preview.src === window.location.href) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('analyzeBtn').style.display = 'none';
            
            try {
                let result;
                
                if (mockMode) {
                    // Mock mode - simulate analysis
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Generate mock predictions
                    const mockPredictions = generateMockPredictions();
                    result = processResults(mockPredictions);
                } else {
                    // Real model prediction
                    const tensor = preprocessImage(preview);
                    const predictions = await model.predict(tensor).data();
                    tensor.dispose();
                    result = processResults(predictions);
                }
                
                result.imageData = preview.src;
                result.timestamp = new Date();
                
                // Show results
                displayResults(result);
                
                // Update stats
                analyzeCount++;
                updateStats();
                
            } catch (error) {
                console.error('Analysis error:', error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function preprocessImage(imgElement) {
            return tf.tidy(() => {
                let img = tf.browser.fromPixels(imgElement);
                img = tf.image.resizeBilinear(img, [224, 224]);
                img = img.div(255.0);
                return img.expandDims(0);
            });
        }
        
        function generateMockPredictions() {
            // Generate random predictions that sum to 1
            const pred1 = Math.random() * 0.5 + 0.5; // 0.5 to 1.0
            const pred2 = Math.random() * (1 - pred1);
            const pred3 = 1 - pred1 - pred2;
            
            // Randomly order them
            const predictions = [pred1, pred2, pred3];
            return predictions.sort(() => Math.random() - 0.5);
        }
        
        function processResults(predictions) {
            const maxIndex = predictions.indexOf(Math.max(...predictions));
            const confidence = predictions[maxIndex];
            const soilData = soilTypes[maxIndex];
            
            // Generate pH and moisture values within the range for this soil type
            const phValue = (Math.random() * (soilData.phRange.max - soilData.phRange.min) + soilData.phRange.min).toFixed(1);
            const moistureValue = Math.floor(Math.random() * (soilData.moistureRange.max - soilData.moistureRange.min) + soilData.moistureRange.min);
            
            return {
                soilType: maxIndex,
                soilData: soilData,
                confidence: confidence,
                allPredictions: Array.from(predictions),
                phValue: phValue,
                moistureValue: moistureValue
            };
        }
        
        // ============================================
        // Display Results
        // ============================================
        function displayResults(result) {
            // Show result section
            document.getElementById('resultDisplay').style.display = 'block';
            document.getElementById('emptyResult').style.display = 'none';
            
            // Update soil type with icon
            const iconElement = document.getElementById('soilIcon');
            iconElement.innerHTML = `<i class="fas ${result.soilData.icon}" style="font-size: 5rem;"></i>`;
            document.getElementById('soilName').textContent = 
                `${result.soilData.name} (${result.soilData.nameEn})`;
            
            // Update confidence bar
            const confidencePercent = (result.confidence * 100).toFixed(1);
            const confidenceFill = document.getElementById('confidenceFill');
            confidenceFill.style.width = `${confidencePercent}%`;
            confidenceFill.textContent = `${confidencePercent}%`;
            
            // Confidence color
            if (result.confidence > 0.8) {
                confidenceFill.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
            } else if (result.confidence > 0.6) {
                confidenceFill.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
            } else {
                confidenceFill.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            }
            
            // Update pH value
            document.getElementById('phValue').textContent = result.phValue;
            const phStatus = getPhStatus(parseFloat(result.phValue));
            document.getElementById('phStatus').textContent = phStatus;
            
            // Update moisture value
            document.getElementById('moistureValue').textContent = `${result.moistureValue}%`;
            const moistureStatus = getMoistureStatus(result.moistureValue);
            document.getElementById('moistureStatus').textContent = moistureStatus;
            
            // Update recommendations
            const recList = document.getElementById('recommendationsList');
            recList.innerHTML = '';
            result.soilData.recommendations.forEach(rec => {
                const item = document.createElement('div');
                item.className = 'recommendation-item';
                item.innerHTML = `
                    <i class="fas ${rec.icon}"></i>
                    <span>${rec.text}</span>
                `;
                recList.appendChild(item);
            });
            
            // Store current result
            window.currentResult = result;
        }
        
        function getPhStatus(ph) {
            if (ph < 5.5) return '‡∏Å‡∏£‡∏î‡∏à‡∏±‡∏î (‡∏Ñ‡∏ß‡∏£‡πÉ‡∏™‡πà‡∏õ‡∏π‡∏ô‡∏Ç‡∏≤‡∏ß)';
            else if (ph < 6.0) return '‡∏Å‡∏£‡∏î‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á';
            else if (ph < 7.0) return '‡∏Å‡∏£‡∏î‡∏≠‡πà‡∏≠‡∏ô (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°)';
            else if (ph === 7.0) return '‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏î‡∏µ‡∏°‡∏≤‡∏Å)';
            else if (ph < 7.5) return '‡∏î‡πà‡∏≤‡∏á‡∏≠‡πà‡∏≠‡∏ô';
            else return '‡∏î‡πà‡∏≤‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á';
        }
        
        function getMoistureStatus(moisture) {
            if (moisture < 15) return '‡πÅ‡∏´‡πâ‡∏á‡∏°‡∏≤‡∏Å (‡∏Ñ‡∏ß‡∏£‡∏£‡∏î‡∏ô‡πâ‡∏≥)';
            else if (moisture < 25) return '‡πÅ‡∏´‡πâ‡∏á';
            else if (moisture < 40) return '‡∏û‡∏≠‡πÄ‡∏´‡∏°‡∏≤‡∏∞';
            else if (moisture < 50) return '‡∏ä‡∏∑‡πâ‡∏ô';
            else return '‡∏ä‡∏∑‡πâ‡∏ô‡∏°‡∏≤‡∏Å (‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°)';
        }
        
        // ============================================
        // Camera Functions
        // ============================================
        async function openCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                cameraStream = stream;
                document.getElementById('cameraVideo').srcObject = stream;
                document.getElementById('cameraModal').style.display = 'block';
            } catch (error) {
                showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ', 'error');
            }
        }
        
        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            canvas.toBlob((blob) => {
                const file = new File([blob], `camera-${Date.now()}.jpg`, { type: 'image/jpeg' });
                handleSingleFile(file);
                closeCamera();
            }, 'image/jpeg', 0.9);
        }
        
        function closeCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            document.getElementById('cameraModal').style.display = 'none';
        }
        
        // ============================================
        // History Management
        // ============================================
        function saveToHistory() {
            if (!window.currentResult) return;
            
            analysisHistory.push(window.currentResult);
            saveHistory();
            updateHistoryView();
            
            showMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        
        function saveHistory() {
            localStorage.setItem('soilAnalysisHistory', JSON.stringify(analysisHistory));
        }
        
        function loadHistory() {
            const saved = localStorage.getItem('soilAnalysisHistory');
            if (saved) {
                analysisHistory = JSON.parse(saved);
                updateHistoryView();
            }
        }
        
        function updateHistoryView() {
            const container = document.getElementById('historyContent');
            
            if (analysisHistory.length === 0) {
                container.innerHTML = '<p class="text-center" style="color: #95a5a6;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>';
                return;
            }
            
            let html = '<table class="history-table"><thead><tr>';
            html += '<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏î‡∏¥‡∏ô</th><th>pH</th><th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</th><th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à</th><th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>';
            html += '</tr></thead><tbody>';
            
            analysisHistory.slice().reverse().forEach((item, index) => {
                const date = new Date(item.timestamp);
                const icon = `<i class="fas ${item.soilData.icon}"></i>`;
                html += `<tr>
                    <td>${date.toLocaleString('th-TH')}</td>
                    <td>${icon} ${item.soilData.name}</td>
                    <td>${item.phValue || '-'}</td>
                    <td>${item.moistureValue ? item.moistureValue + '%' : '-'}</td>
                    <td>${(item.confidence * 100).toFixed(1)}%</td>
                    <td>
                        <button class="btn btn-sm" onclick="viewHistoryItem(${analysisHistory.length - 1 - index})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function viewHistoryItem(index) {
            const item = analysisHistory[index];
            displayResults(item);
            window.scrollTo(0, document.getElementById('analyze').offsetTop - 100);
        }
        
        function clearHistory() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                analysisHistory = [];
                saveHistory();
                updateHistoryView();
                showMessage('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }
        
        // ============================================
        // Export Functions
        // ============================================
        function exportToPDF() {
            if (!window.currentResult) {
                showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.text('Soil Analysis Report', 105, 20, { align: 'center' });
            
            // Date
            doc.setFontSize(12);
            doc.text(`Date: ${new Date().toLocaleDateString('th-TH')}`, 20, 40);
            doc.text(`Time: ${new Date().toLocaleTimeString('th-TH')}`, 20, 50);
            
            // Results with pH and moisture
            doc.setFontSize(16);
            doc.text(`Soil Type: ${window.currentResult.soilData.name} (${window.currentResult.soilData.nameEn})`, 20, 70);
            doc.text(`Confidence: ${(window.currentResult.confidence * 100).toFixed(1)}%`, 20, 80);
            doc.text(`pH: ${window.currentResult.phValue} (${getPhStatus(parseFloat(window.currentResult.phValue))})`, 20, 90);
            doc.text(`Moisture: ${window.currentResult.moistureValue}% (${getMoistureStatus(window.currentResult.moistureValue)})`, 20, 100);
            
            // Recommendations
            doc.setFontSize(14);
            doc.text('Recommendations:', 20, 120);
            
            let yPos = 130;
            window.currentResult.soilData.recommendations.forEach((rec, index) => {
                doc.setFontSize(12);
                const text = `${index + 1}. ${rec.text}`;
                const lines = doc.splitTextToSize(text, 170);
                lines.forEach(line => {
                    doc.text(line, 25, yPos);
                    yPos += 7;
                });
                yPos += 3;
            });
            
            // Save
            doc.save(`soil-analysis-${Date.now()}.pdf`);
            showMessage('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        
        function exportHistory(format) {
            if (analysisHistory.length === 0) {
                showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', 'error');
                return;
            }
            
            if (format === 'csv') {
                let csv = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡πÄ‡∏ß‡∏•‡∏≤,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏î‡∏¥‡∏ô,pH,‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%),‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à (%)\n';
                
                analysisHistory.forEach(item => {
                    const date = new Date(item.timestamp);
                    csv += `${date.toLocaleDateString('th-TH')},`;
                    csv += `${date.toLocaleTimeString('th-TH')},`;
                    csv += `${item.soilData.name},`;
                    csv += `${item.phValue || '-'},`;
                    csv += `${item.moistureValue || '-'},`;
                    csv += `${(item.confidence * 100).toFixed(1)}\n`;
                });
                
                // Download CSV
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `soil-analysis-history-${Date.now()}.csv`;
                link.click();
                
                showMessage('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV ‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }
        
        function shareResult() {
            if (!window.currentResult) {
                showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', 'error');
                return;
            }
            
            const text = `‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô: ${window.currentResult.soilData.name} (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à ${(window.currentResult.confidence * 100).toFixed(1)}%) | pH: ${window.currentResult.phValue} | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${window.currentResult.moistureValue}%`;
            
            if (navigator.share) {
                navigator.share({
                    title: '‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô - SoilAI',
                    text: text,
                    url: window.location.href
                }).catch(err => console.log('Share cancelled'));
            } else {
                // Copy to clipboard
                navigator.clipboard.writeText(text).then(() => {
                    showMessage('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success');
                });
            }
        }
        
        // ============================================
        // Theme Management
        // ============================================
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            // Update icon
            document.getElementById('themeIcon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }
        
        function checkTheme() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            }
        }
        
        // ============================================
        // Utility Functions
        // ============================================
        function resetUpload() {
            document.getElementById('imageInput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('analyzeBtn').style.display = 'none';
            document.getElementById('resultDisplay').style.display = 'none';
            document.getElementById('emptyResult').style.display = 'block';
            
            hideMessage();
        }
        
        function updateStats() {
            document.getElementById('analyzeCount').textContent = analyzeCount;
        }
        
        function showMessage(message, type) {
            hideMessage();
            
            let element;
            if (type === 'error') {
                element = document.getElementById('errorMessage');
            } else if (type === 'success') {
                element = document.getElementById('successMessage');
            } else {
                // Use success message for info
                element = document.getElementById('successMessage');
            }
            
            element.textContent = message;
            element.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(hideMessage, 5000);
        }
        
        function hideMessage() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }
        
        // ============================================
        // Keyboard Shortcuts
        // ============================================
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + O = Open file
            if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
                e.preventDefault();
                document.getElementById('imageInput').click();
            }
            
            // Ctrl/Cmd + S = Save to history
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveToHistory();
            }
            
            // Ctrl/Cmd + E = Export PDF
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportToPDF();
            }
        });
        
        // ============================================
        // Mobile Optimizations
        // ============================================
        // Detect mobile
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        if (isMobile) {
            // Adjust UI for mobile
            document.querySelectorAll('.btn').forEach(btn => {
                btn.style.padding = '15px 25px';
            });
        }
        
        // ============================================
        // Error Handling
        // ============================================
        window.addEventListener('error', (e) => {
            console.error('Global error:', e);
            showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
        });
        
        // Handle offline
        window.addEventListener('offline', () => {
            showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï', 'error');
        });
        
        window.addEventListener('online', () => {
            showMessage('‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success');
        });
    </script>
</body>
</html>